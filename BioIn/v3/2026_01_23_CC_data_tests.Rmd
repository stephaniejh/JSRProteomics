---
title: "2026_01_23_CC_data_tests"
author: "Stephanie Huang"
date: "2026-01-23"
output: html_document
---

This document tests various mapping graphics to present the GO CC data.

1.  Fluctuator() + SwissBioPics svg (used in uniprtot)
    1.  <https://github.com/m-jahn/fluctuator>
    2.  <https://www.swissbiopics.org/>
    3.  <https://www.uniprot.org/help/subcellular_location>
2.  <https://github.com/svalvaro/drawCell> (access SwissBioPic Api) - a bit tricky
3.  <https://github.com/jespermaag/gganatogram>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load Packages

```{r}
# #devtools::install_github("m-jahn/fluctuator")
# #devtools::install_github("svalvaro/drawCell")
# #devtools::install_github("jespermaag/gganatogram")

# Load packages 
library(tidyverse)

library(fluctuator) # for read_svgs & working with svgs

library(drawCell) #
library(htmlwidgets)
library(webshot2)

library(gganatogram)
library(viridis)
library(gridExtra)

library(ggseg)
```

# 1 - Testing Fluctuator

Note works (as long as inkscake svg format) but heirachical structuring of the Swiss BioPics is kinda confuseing

## Read in Template with SVG (e.g. inkscape made)

-   Error in xpathApply.XMLInternalDocument(doc, path, fun, ..., namespaces = namespaces, : error evaluating xpath expression //svg:path\
    XPath error : Undefined namespace prefix

    -   download svg from SwissBioPics & then open in inkscape & save as inkscape svg (also .svg but some how fixes error!!! yaya!!! :D)

-   

```{r}

# neuron_1 <- read_svg("input/img/Neuron_cells_inkscape.svg")

# ani_cell_1 <- read_svg("input/img/Animal_cells_SwissBioPics.svg")

class(neuron_1) #  "XMLsvg" attr(,"package") "fluctuator"

# access summary table of objects/nodes
head(neuron_1@summary) # tib  6 × 49
```

Get Attributes of SVG

```{r}
get_attributes(neuron_1, node = "node_1", node_attr = "id")
```

Change Attributes of SVG

set_attributes() - takes 4

```{r}
neuron_2 <-  set_attributes(neuron_1,
                            node = "node_1",
                            node_attr = "id",
                            attr = "style",
                            pattern = "fill:#808080",
                            replacement = "fill:#FF0000")
```

```{r}
# write_svg(neuron_2, file = "output/test_neuron_output_1.svg")
```

------------------------------------------------------------------------

# 2 - Revisitng drawCell

drawCell:drawCell

-   TaxonId - <https://www.ncbi.nlm.nih.gov/taxonomy/>

-   list_sl_colors (subcellular location) - <http://current.geneontology.org/ontology/external2go/uniprotkb_sl2go>

-   Code for neuron is 6072

-   export widget <https://stackoverflow.com/questions/40089207/how-to-arrange-html-widget-plots-in-a-grid-for-export-as-pdf>

-   <https://forum.posit.co/t/save-viewer-object-rendered-in-rstudio-as-image/32796/10>

-   <https://github.com/wch/webshot/issues/72>

```{r}

mycell <- drawCell::drawCell(organism_identifier = "6072",
                   list_sl_colors = list("SL0288" = "orange",
                                         "SL0191" = "#1F4861",
                                         "SL0259" = "forestgreen",
                                         "SL0260" = "#BD88A5"),
                   # width = 1500,
                   # height = 500
                   )

# 
saveWidget(mycell, "temp.html") # htmlwidgets


webshot(url = "temp.html", #webshot2
        file = "temp_3.pdf",
        # file = "temp.png",
        cliprect = c(200, 5, 400, 300),
        zoom = 2, # not changing??? 
        # vwidth = 992,
        # vheight = 744,
        # cliprect = "viewport", 
        delay = 10 # adding delay fixes problem (slow! otherwise blanks)
        )
```

```{r}
# drawCell::drawCellOutput(mycell, width = "100%", height = "400px")

```

------------------------------------------------------------------------

# 3 - ggAnatogram

<https://github.com/jespermaag/gganatogram/tree/master?tab=readme-ov-file#readme>

```{r}
hgMale <- gganatogram(data=hgMale_key,
                      fillOutline='#a6bddb', organism='human',
                      sex='male', fill="colour") + theme_void()

hgFemale <- gganatogram(data=hgFemale_key,
                        fillOutline='#a6bddb', organism='human',
                        sex='female', fill="colour") + theme_void()

mmMale <- gganatogram(data=mmMale_key,
                      fillOutline='#a6bddb', organism='mouse',
                      sex='male', fill="colour") + theme_void()

mmFemale <- gganatogram(data=mmFemale_key,
                        outline = T, fillOutline='#a6bddb', organism='mouse',
                        sex='female', fill="colour")  +theme_void()  

grid.arrange(hgMale, hgFemale, mmMale, mmFemale, ncol=4)
```

```{r}
organPlot <- data.frame(organ = c(
  "heart", "leukocyte", "nerve", "brain", "liver", "stomach", "colon"), 
 type = c(
   "circulation", "circulation",  "nervous system", "nervous system",
   "digestion", "digestion", "digestion"), 
 colour = c("red", "red", "purple", "purple", "orange", "orange", "orange"), 
 value = c(10, 5, 1, 8, 2, 5, 5), 
 stringsAsFactors=F)
```

```{r}
gganatogram(data=organPlot, fillOutline='#a6bddb', organism='human', sex='male', fill="colour")

gganatogram(data=organPlot, fillOutline='#a6bddb', organism='human', sex='male', fill="colour") + 
theme_void()


```

```{r}
hgMale_key$organ

gganatogram(data=hgMale_key, fillOutline='#a6bddb', organism='human', sex='male', fill="colour") +theme_void()

```

```{r}
organPlot %>%
    dplyr::filter(type %in% c('circulation', 'nervous system')) %>%
gganatogram(outline=F, fillOutline='#a6bddb', organism='human', sex='male', fill="colour") + 
theme_void()
```

```{r}
# THIS IS WHAT I WANT FOR GGPLOR
gganatogram(data=organPlot, fillOutline='#a6bddb', organism='human', sex='male', fill="value") + 
theme_void() +
scale_fill_gradient(low = "white", high = "red")
```

```{r}
compareGroups <- rbind(data.frame(organ = c("heart", "leukocyte", "nerve", "brain", "liver", "stomach", "colon"), 
  colour = c("red", "red", "purple", "purple", "orange", "orange", "orange"), 
 value = c(10, 5, 1, 8, 2, 5, 5), 
 type = rep('Normal', 7), 
 stringsAsFactors=F),
 data.frame(organ = c("heart", "leukocyte", "nerve", "brain", "liver", "stomach", "colon"), 
  colour = c("red", "red", "purple", "purple", "orange", "orange", "orange"), 
 value = c(5, 5, 10, 8, 2, 5, 5), 
 type = rep('Cancer', 7), 
 stringsAsFactors=F))
```

```{r}
gganatogram(data=compareGroups, fillOutline='#a6bddb', organism='human', sex='male', fill="value") + 
theme_void() +
facet_wrap(~type) +
scale_fill_gradient(low = "white", high = "red") 
```

## Cell Structures

Cite Thul <https://www.science.org/doi/10.1126/science.aal3321>

```{r}
cell_key # from Thul
```

```{r}
# plot everthing
gganatogram(data=cell_key[['cell']], outline = T, fillOutline='steelblue', organism="cell", fill="colour")  +theme_void()   + coord_fixed()

gganatogram(data=cell_key[['cell']], outline = T, fillOutline='lightgray', organism="cell", fill="value")  +theme_void() +  coord_fixed() +  scale_fill_viridis()
```

```{r}
# see substructures individually 

figureList <- list()
for (i in 1:nrow(cell_key[['cell']])) {
    figureList[[i]] <- gganatogram(data=cell_key[['cell']][i,], outline = T, fillOutline='steelblue', organism="cell", fill="colour")  +theme_void() +ggtitle(cell_key[['cell']][i,]$organ) + theme(plot.title = element_text(hjust=0.5, size=16)) + coord_fixed()
}

do.call(grid.arrange,  c(figureList[1:4], ncol=2))
do.call(grid.arrange,  c(figureList[5:8], ncol=2)) # so on & so forth
```

## Other organisms i.e. tier 2 organisms

includes rat!

ebi expression atlast -  <https://ebi-gene-expression-group.github.io/anatomogram/>

```{r}
other_key # other organisms
names(other_key)
other_key[["bos_taurus"]]

gganatogram(data=other_key[["bos_taurus"]],
            outline = T, fillOutline='white', organism="bos_taurus",
            sex='female', fill="colour")  +
        theme_void() +
        ggtitle("bos_taurus") + 
        theme(plot.title = element_text(hjust=0.5)) + 
        coord_fixed()
```

```{r}
# loop through all other organisms & plot their organis

library(gridExtra)

plotList <- list()

for (organism in names(other_key)) {
    plotList[[organism]] <- gganatogram(data=other_key[[organism]],
                                        outline = T,   fillOutline='white',
                                        organism=organism, sex='female',
                                        fill="colour")  +
                theme_void() +
                ggtitle(organism) + 
                theme(plot.title = element_text(hjust=0.5, size=9)) + 
                coord_fixed()
}

do.call(grid.arrange,  c(plotList[1:4], ncol=2))
do.call(grid.arrange,  c(plotList[13:16], ncol=2))
```

## Added Mouse Brain 

```{r}
mouse_brain_key <- data.frame(organ = names(gganatogram::other_list[['mus_musculus.brain']])[1:12], 
          type = 'brain', 
          colour = c("#7FC97F", "#BEAED4", "#FDC086", "#FFFF99", "#386CB0", "#F0027F", 
                     "#BF5B17", "#666666", "#1B9E77", "#D95F02", "#7570B3", "#E7298A"),
          value = rnorm(n =12, mean = 100, sd  =50))


gganatogram(data=mouse_brain_key, outline = T, fillOutline='white', organism="mus_musculus.brain", sex='female', fill="colour") +
  theme_void() 
```

```{r}
mouse_brain_key$type <- mouse_brain_key$organ



gganatogram(data=mouse_brain_key, outline = T, fillOutline='white', organism="mus_musculus.brain", sex='female', fill="colour") +
  theme_void() +
  facet_wrap(~type)
```

# 4 - ggseg

-   <https://ggseg.github.io/ggseg/>

```{r}
plot(dk$data)
plot(dk)
```
