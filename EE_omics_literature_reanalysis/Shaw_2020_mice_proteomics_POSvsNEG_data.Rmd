---
title: "2025_10_28_Shaw_2020_proteomics_data"
author: "Stephanie Huang"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Links

-   Dataset via Mendeley Data - <https://data.mendeley.com/datasets/5b4477386w/1>

Legit kinda weird! - Has a billion rodents, the mapping of groups & samples is confusing

# Part 1 - Setup & General Checks 

Part 1 contains the setup & general checks. This data is really weird so here I make various plots & tables to examine the data.

## Setup

```{r include=FALSE}
library(tidyverse) # ggplot, dplyr, etc
library(ggrepel) #  for geom_text_repel()
library(gt) # gt() tables
library(pheatmap)
```

### Load in data

```{r}
frontal_file <- read_csv("input/Shaw_2020_UCLan_Preomics_Data_Frontal.csv", col_names = FALSE)

colnames(frontal_file) <- frontal_file[3,] # assign row 3 as headers

frontal_file <- frontal_file[-1:-3,] # negative index (rm rows 1-3) |data starts r4

# 1st data obs is ODP2_MESAU 
```

```{r}
head(frontal_file)
str(frontal_file)
```

```{r}
hippo_file <- read_csv("input/Shaw_2020_UCLan_Preomics_Data_Hippocampus.csv", col_names = FALSE)

colnames(hippo_file) <- hippo_file[3,] # assign row 3 as header

hippo_file <- hippo_file[-1:-3,] # negative index (rm rows 1-3) |data starts r4
# 1st data obs is KPCA mouse
```

```{r}
head(hippo_file)
str(hippo_file)
```

```{r}
fr_others <- frontal_file %>%
  filter(!str_detect(Accession, "MOUSE|RAT")) # not mouse or rat

# gives weird rodents - 80 of 977 are not mice or rats 
# like GNAI2_CAVPO (Gerbil) ODP2_MESAU Golden Hamster | GNAI2_CAVPO Guinea Pig
```

### Clean up & bind

(doing it sep as the col headers are slightly different)

```{r}
hip_head_id <- c("")
```

```{r}
# fr_mice <- frontal_file %>%
#   filter(str_detect(Accession, "MOUSE"))
# 
# # 675/977 contain mice, 
```

```{r}
Frontal <- frontal_file %>%
  # filter(`Anova (p)` < 0.0505) %>%
  select(1:12) %>%
  mutate_at(c('Confidence score', 'Anova (p)', 'q Value',
              'Max fold change', 'Power'), as.numeric)
```

```{r}
Hippo <- hippo_file %>%
  # filter(`Anova (p)` < 0.0505) %>%
  select(1:12) %>%
  mutate_at(c('Confidence score', 'Anova (p)', 'q Value',
              'Max fold change', 'Power'), as.numeric)
```

```{r}
combined <- bind_rows(list(Frontal = Frontal, Hippocampus = Hippo),
                      .id = "Region") %>%
  mutate( # recode so 1A 2B match the groups - A is POS, B is NEG
    highest_mean = ifelse(str_detect(`Highest mean condition`, "A"), "POS", "NEG"),
    lowest_mean = ifelse(str_detect(`Lowest mean condition`, "A"), "POS", "NEG"),
    .after = `Lowest mean condition`
    )
```

```{r}
summary(combined)
```

```{r fig.height=7, fig.width=11}
volcano_pv <- ggplot(combined, 
                     aes(x = `Max fold change`, y = -log10(`Anova (p)`),
                         label = Accession)) +
  geom_point(aes(color = case_when(
    `Anova (p)` < 0.05 & `Max fold change` > 0.05 ~ "Upregulated (p<0.05)",
    `Anova (p)` < 0.05 & `Max fold change` < -0.05 ~ "Downregulated (p<0.05)",
                                   TRUE ~ "Not Significant")),
            alpha = 1, size = 2, shape = 1) +
  xlim(-8,12) +
  geom_vline(xintercept = 0, linetype = "dashed",
             color = "grey40", linewidth = .5) +
  scale_color_manual(values = c("firebrick3", 
                                "royalblue4", 
                                 "grey80"),
                     breaks = c("Upregulated (p<0.05)", 
                                "Downregulated (p<0.05)", 
                                "Not Significant"),
                     labels = c("Upregulated Proteins (p<0.05)", 
                                "Downregulated Proteins (p<0.05)", 
                                "Not Significant")) +
  
  geom_text_repel() +
  facet_wrap(highest_mean~Region, ncol = 2) +
  labs(
    title = "???? no fold change? or is this just up in EE?",
    subtitle = 'Also coding is weird - why frontal all higes in pos & neg',
       x = "Log2 Signal",
       y = "-Log10(p-value)",
       color = "mRNA Regulation") +
  theme_bw() +
  theme(legend.position = "bottom")



volcano_pv

```

------------------------------------------------------------------------

### Heatmap check (done on separate raw/original df provided by shaw) 

```{r fig.height=13, fig.width=11}
# Making a maxtrix - dplyr/tidyverse style
f_matrix <- frontal_file %>%
  filter(`Anova (p)` <= 0.06) %>%
  select(c(Accession,AS_01_1_in_10:AS_1_in_10_23)) %>% # get cols
  tibble::column_to_rownames("Accession") %>% # set Accession to rowname 
  mutate(across(everything(), as.numeric)) %>% # as numeric! 
  as.matrix() # make matrix 

# 
f_heatmap <- pheatmap(f_matrix, main = "Frontal Lobe - p.05")
```

```{r fig.height=4, fig.width=11}
# Making a maxtrix - dplyr/tidyverse style
h_matrix <- hippo_file %>%
  filter(`Anova (p)` <= 0.05) %>%
  select(c(Accession,AS_1_in_10_02:AS_1_in_10_24)) %>% # get cols
  tibble::column_to_rownames("Accession") %>% # set Accession to rowname
  mutate(across(everything(), as.numeric)) %>% # as numeric!
  as.matrix() # make matrix

h_heatmap <- pheatmap(h_matrix, main = "Hippocampus - p.05")
```

------------------------------------------------------------------------

### gt table (of sig) 

```{r}
combined |>
  dplyr::filter(`Anova (p)` <= 0.05) |>
  gt(
    groupname_col = "Region"
    ) |>
  fmt_number(decimals = 3) |>
  # data_color(columns = "Regulation") +
  tab_options(table.font.size=11.5) |>
  tab_header(
    title = "Shaw et al., 2020 Proteomics - NEG vs POS - Check 1",
    subtitle = "From Frontal (47/48) & Hippocampus (5) - p-value <0.0505"
  )
  # tab_style(
  #   style = cell_fill(color = "lightblue"),
  #   locations = cells_body(rows = log2FC < 0)
  # )
```

------------------------------------------------------------------------

# Part 2 - mapping & other stuff

```{r}

```

```{r}
sessionInfo()
```
